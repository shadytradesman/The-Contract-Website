{% extends "site_base.html" %}

{% load i18n %}
{% load staticfiles %}

{% block head_title %}
    {{character.name}}'s Journal
{% endblock %}

{% block extra_head %}
    {{ form.media }}
{% endblock %}

{% block extra_styles %}
    <link rel="stylesheet" type="text/css" href="{% static 'journals/journal_read_style.css' %}" />
{% endblock %}

{% block body_base %}
<div class="container">
    <h1 class="text-center">
        {{character.name}}'s Journal
    </h1>

    <ul class="nav nav-tabs" role="tablist">
        {% for journal_page in journal_pages %}
            <li role="presentation"
                class="
                    {% if journal_page.game.id == view_game_id %} active {% endif %}
                    {% if journal_page.empty %} css_empty_page {% endif %}">
                <a href="#{{journal_page.id}}" aria-controls="{{journal_page.id}}" role="tab" data-toggle="tab">
                    {{journal_page.header}}
                </a>
            </li>
        {% endfor %}
    </ul>
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="tab-content">
                {% for journal_page in journal_pages %}
                    <div role="tabpanel"
                         class="tab-pane {% if journal_page.game.id == view_game_id %} active {% endif %}"
                         id="{{journal_page.id}}">
                        {% if journal_page.game_journal %}
                            <small>{{journal_page.game.scenario.title}} (view Game)</small>
                            <div class="thumbnail">
                                <h3>
                                    {{journal_page.game_journal.title}}
                                </h3>
                                <div>
                                    {{journal_page.game_journal.content|safe}}
                                </div>
                            </div>
                        {% else %}
                            {% if viewer_can_write %}
                                <div class="alert alert-success text-center">
                                    You have not written a journal for this game yet.
                                    You will earn 1 Exp for {{character.name}} if you write an in-character journal about
                                    the events of the Game.
                                    <br>
                                    <a class="btn btn-primary"
                                       href="{% url 'journals:journal_write_game' journal_page.game.id character.id %}">
                                        Write Journal
                                    </a>
                                </div>
                            {% endif %}
                        {% endif %}
                        {% for journal in journal_page.downtime_journals %}
                            <small>Downtime</small>
                            <div class="thumbnail">
                                <h3>
                                    {{journal.title}}
                                </h3>
                                <div>
                                    {{journal.content|safe}}
                                </div>
                            </div>
                        {% endfor %}
                        {% if viewer_can_write %}
                            <div class="text-center alert {% if journal_page.downtime_journals %} alert-info {% else %} alert-success {% endif %}">
                                {% if journal_page.downtime_journals %}
                                    You may write additional Downtime journals, but you will not gain extra Experience from them.
                                {% else %}
                                    You have not written a Downtime Journal for this Game yet.
                                    You will earn 1 Exp for {{character.name}} if you write an in-character Journal at least
                                    250 words in length explaining what occurred between this Game and the next.
                                {% endif %}
                                <br>
                                <a class="btn btn-primary"
                                   href="{% url 'journals:journal_write_downtime' journal_page.game.id character.id %}">
                                    Write Downtime Journal
                                </a>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
