{% load markdown_deux_tags %}
{% load bootstrap %}

<script type="text/html" id="scar-template">
    <li class="stat-value">
        <form style="display: inline-block" class="js-delete-scar-form" data-del-scar-url=__delUrl__>
            {% csrf_token %}
            <input type="submit" class="btn btn-xs btn-danger" value="X" />
        </form>
        <b>__description__</b> (__system__)
    </li>
</script>
<script type="text/html" id="injury-template">
    <span>
        <div class="stat-value col-xs-3 text-center css-injury-val">
            <form class="js-edit-injury-form"
                  style="display: inline-block;"
                  data-edit-injury-url=__decUrl__>
                    {% csrf_token %}
                <button type="submit" class="btn btn-default btn-xs">
                    <i class="fa fa-minus"></i>
                </button>
            </form>
            <b class="injury-severity">__severity__</b>
            <form class="js-edit-injury-form"
                  style="display: inline-block;"
                  data-edit-injury-url=__incUrl__>
                    {% csrf_token %}
                <button type="submit" class="btn btn-default btn-xs">
                    <i class="fa fa-plus"></i>
                </button>
            </form>
        </div>
        <div class="stat-value col-xs-9">
            __description__
            {% if user_can_edit and not character.is_dead %}
                <form class="js-delete-injury-form pull-right" data-del-injury-url=__delUrl__>
                    {% csrf_token %}
                    <input type="submit" class="btn btn-xs btn-danger" value="X"/>
                </form>
            {%endif%}
        </div>
        <div class="clearfix"></div>
    </span>
</script>
<div class="row text-center">
    <div class="col-xs-12">
        <h3 data-toggle="tooltip" title='{{tutorial.injuries}}'>Injuries</h3>
        <div class="text-left" id="js-injury-container">
            {% for injury in character.injury_set.all %}
                <span>
                    <div class="stat-value col-xs-3 text-center css-injury-val">
                        {% if user_can_edit and not character.is_dead %}
                        <form class="js-edit-injury-form"
                              style="display: inline-block;"
                              data-edit-injury-url="{% url 'characters:dec_injury' injury.id secret_key %}">
                                {% csrf_token %}
                            <button type="submit" class="btn btn-default btn-xs">
                                <i class="fa fa-minus"></i>
                            </button>
                        </form>
                        {% endif %}
                        <b class="injury-severity">{{injury.severity}}</b>
                        {% if user_can_edit and not character.is_dead %}
                        <form class="js-edit-injury-form"
                              style="display: inline-block;"
                              data-edit-injury-url="{% url 'characters:inc_injury' injury.id secret_key %}">
                                {% csrf_token %}
                            <button type="submit" class="btn btn-default btn-xs">
                                <i class="fa fa-plus"></i>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                    <div class="stat-value col-xs-9">
                        {{injury.description}}
                        {% if user_can_edit and not character.is_dead %}
                            <form class="js-delete-injury-form pull-right" data-del-injury-url="{% url 'characters:delete_injury' injury.id secret_key %}">
                                {% csrf_token %}
                                <input type="submit" class="btn btn-xs btn-danger" value="X"/>
                            </form>
                        {%endif%}
                    </div>
                    <div class="clearfix"></div>
                </span>
            {% empty %}
                <h4 class="text-center" id="js-no-injuries"><small>({{character.name}} is unharmed)</small></h4>
            {% endfor%}
        </div>
        {% if user_can_edit and not character.is_dead %}
            <br>
            <div class="col-xs-12">
            <div class="row form-inline">
                <form id="injury-form"
                      class="injury-form"
                      data-new-injury-url="{% url 'characters:post_injury' character.id secret_key %}"
                      data-inc-injury-url="{% url 'characters:inc_injury' 'injuryIdJs' secret_key %}"
                      data-dec-injury-url="{% url 'characters:dec_injury' 'injuryIdJs' secret_key %}"
                      data-delete-injury-url="{% url 'characters:delete_injury' 'injuryIdJs' secret_key %}">
                    {{ injury_form.about.errors }}
                    {{ injury_form.non_field_errors }}
                    {% csrf_token %}
                    <span class="js-injury-form">
                        {{ injury_form.severity }}
                    </span>
                    {{injury_form.description}}
                    <input type="submit" class="btn btn-default" value="Ouch!" />
                </form>
            </div>
            </div>
        {% endif %}
    </div>
</div>
{% include "characters/view_pages/complication_reference.html" %}
<div class="row text-center">
    <div class="col-xs-12">
        <h3 data-toggle="tooltip" title='{{tutorial.battle_scars}}'>Battle Scars</h3>
        <div class="text-left" id="js-scar-container">
            {% for scar in character.battlescar_set.all %}
                <li class="stat-value">
                    {% if user_can_edit %}
                        <form style="display: inline-block" class="js-delete-scar-form" data-del-scar-url="{% url 'characters:delete_scar' scar.id secret_key %}">
                            {% csrf_token %}
                            <input type="submit" class="btn btn-xs btn-danger" value="X" />
                        </form>
                    {%endif%}
                    <b>{{scar.description}}</b> {% if scar.system %} ({{scar.system}}) {% endif %}
                </li>
            {% empty %}
            <h4 class="text-center" id="js-no-scars"><small>({{character.name}} has no Battle Scars)</small></h4>
            {% endfor%}
        </div>
        {% if user_can_edit %}
        <div class="text-center">
            <a class="btn btn-default btn-sm wiki-entry-collapsible text-center">Add Battle Scar</a>
            <div class="collapse-content clearfix" style="display:none;">
                <div class="text-left">
                    <form id="scar-form"
                          data-new-scar-url="{% url 'characters:post_scar' character.id secret_key %}"
                          data-delete-scar-url="{% url 'characters:delete_scar' 'scarIdJs' secret_key %}">
                        {% csrf_token %}
                        {{ battle_scar_form.about.errors }}
                        {{ battle_scar_form.non_field_errors }}
                        {{ default_scar_field|bootstrap }}
                        {{ battle_scar_form.scar_description|bootstrap }}
                        {{ battle_scar_form.scar_system|bootstrap }}
                        <div class="text-center">
                            <input type="submit" class="btn btn-primary" value="Add Scar" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>