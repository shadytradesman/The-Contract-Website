commands:
  set_env:
    command: "source /var/app/venv/*/bin/activate"
option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: hgapp.settings
container_commands:
  01_postgres_activate:
    command: "sudo amazon-linux-extras enable postgresql10"
  02_postgres_install:
    command: "sudo yum install -y postgresql-devel"
  03_install_python_reqs:
    command: "source /var/app/venv/*/bin/activate && pip install -r /opt/python/ondeck/app/requirements.txt"
  04_install_node_npm:
    command: "sudo curl --silent --location https://rpm.nodesource.com/setup_10.x | sudo bash -"
  05_update_node_npm:
    command: "sudo yum -y install nodejs"
  06_install_npm_reqs:
    command: "npm --prefix /opt/python/ondeck/app/ install"
  07_run_npm_build:
    command: "npm --prefix /opt/python/ondeck/app/ run build"
  08_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python /opt/python/ondeck/app/manage.py collectstatic --noinput"
  09_migrate:
    command: "source /var/app/venv/*/bin/activate && python /opt/python/ondeck/app/manage.py migrate --noinput"
    leader_only: true
  10_makelog:
    command: "touch /opt/python/ondeck/app/hgapp/APPNAME.log && chmod 777 /opt/python/ondeck/app/hgapp/APPNAME.log"
  11_makelog2:
    command: "touch /opt/python/ondeck/app/hgapp/contract-app.log && chmod 777 /opt/python/ondeck/app/hgapp/contract-app.log"
  12_memcache:
    command: "memcached -m 400 -d -u memcached"